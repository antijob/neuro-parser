{% extends 'core/dashboard/layout.html' %}

{% load static %}

{% block title %}Инцидент из СМИ #{{ incident.pk }}{% endblock title %}

{% block container %}
  {% if form.errors %}
    {% for field, error in form.errors.items %}
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ field }} {{ error }}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Статья в СМИ #{{ incident.pk }}</h6>
    </div>

    <div class="card-body text-dark labels-style">
      <h2>{{ incident.title|default:'Без заголовка' }}</h2>

      <div class="mt-4">
        <label>Описание:</label>
        {{ incident.description|default:'(Не указано)'|linebreaks }}
      </div>

      {% if incident.urls %}
        <div>
          <label>Источники:</label>
          {% for url in incident.urls %}
            <p><a target="_blank" href="{{ url }}">{{ url|truncatechars:70 }}</a></p>
          {% endfor %}
        </div><br>
      {% endif %}
    </div>

  </div>

  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">
      Инцидент из СМИ #{{ incident.pk }}
      <div class="badge status-badge badge-{{ incident.status_color }}">{{ incident.get_status_display }}</div>
      </h6>
    </div>

    <div class="card-body text-dark labels-style">
      <form class="form-horizontal" method="post"
            enctype="multipart/form-data">
        {% csrf_token %}

        <div class="form-group">
          <label>Публичное название:</label>
          {{ form.public_title }}
        </div>

        <div class="form-group">
          <label>Публичное описание:</label>
          {{ form.public_description }}
        </div>

        <div class="form-group">
          <label>Дата инцидента:</label>
          {{ form.create_date }}
        </div>

        <div class="form-group">
          <label>Категория:</label>
          {{ form.incident_type }}
        </div>

        <div class="form-group">
          <label>Регион:</label>
          {{ form.region }}
        </div>

        <div class="form-group">
          <label>Количество нарушений:</label>
          {{ form.count }}
        </div>

        <div class="form-group">
          <label>Источники через запятую:</label>
          {{ form.urls }}
        </div>

        <div class="form-group">
          <label>Теги через запятую:</label>
          {{ form.tags }}
        </div>

        {% if files %}
        <div class="form-group">
          <label>Файлы:</label>
          <table class="table">
            {% for file in files %}
              <tr>
                <td><a href="{{ file.file.url }}">{{ file }}</a></td>
                <td><label class="big-label"><input type="checkbox" name="delete_file" value="{{ file.pk }}"> Удалить</label></td>
              </tr>
            {% endfor %}
          </table>
        </div>
        {% endif %}

        <div class="form-group">
          <label>Добавить файлы:</label>
          {{ form.files }}
        </div>

        <div class="mt-4">
          <button type="submit" name="status" value="2" class="btn btn-success"><i class="fas fa-check"></i> Принять</button>
          <button type="submit" name="status" value="1" class="btn btn-danger"><i class="fas fa-times"></i> Отклонить</button>
          <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Сохранить</button>
        </div>

      </form>

    </div>

  </div>

{% endblock %}

{% block dashboard_scripts %}
  <script src="{% static 'core/datepicker/js/bootstrap-datepicker.min.js' %}"></script>
  <link rel="stylesheet" type="text/css" href="{% static 'core/datepicker/css/bootstrap-datepicker3.min.css' %}">
{% endblock dashboard_scripts %}
